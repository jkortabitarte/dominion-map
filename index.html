<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dominion Map</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    body { margin: 0; }
    #map { height: 100vh; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/h3-js@4.1.0/dist/h3-js.umd.js"></script>

<script>
  const BACKEND_URL = "https://dominion-backend-production.up.railway.app";

  const map = L.map("map").setView([40.4168, -3.7038], 13); // Madrid default

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap"
  }).addTo(map);

  fetch(`${BACKEND_URL}/territories`)
    .then(res => res.json())
    .then(data => {
      data.forEach(t => {
        const boundary = h3.cellToBoundary(t.territory_id, true);

        const polygon = boundary.map(p => [p[1], p[0]]);

        L.polygon(polygon, {
          color: "red",
          fillOpacity: Math.min(0.8, t.influence / 10)
        })
        .bindPopup(`
          <b>Territory</b><br/>
          User: ${t.user_id}<br/>
          Influence: ${t.influence}
        `)
        .addTo(map);
      });
    });
</script>

</body>
</html>
